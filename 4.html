<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Successful</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="st.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="form">
        <h1 class="r">Transaction Successful</h1>
        <div class="welcome">
            <h1 id="transaction-message" class="cur">Transaction Successful</h1>
        </div>

        <script>
            window.onload = function() {
                let username = localStorage.getItem('username');
                let bank = localStorage.getItem('bank');
                let account = localStorage.getItem('account');
                let currency = localStorage.getItem('currency');
                let amount = localStorage.getItem('amount');

                // Retry logic in case the data isn't available yet (if page loads before localStorage is updated)
                const retryInterval = setInterval(function() {
                    username = localStorage.getItem('username');
                    bank = localStorage.getItem('bank');
                    account = localStorage.getItem('account');
                    currency = localStorage.getItem('currency');
                    amount = localStorage.getItem('amount');

                    if (username && bank && account && currency && amount) {
                        clearInterval(retryInterval); // Stop checking once we have the data

                        // Proceed with transaction
                        const message = `${username} has deposited ${currency} ${amount} from ${bank} using account ${account}.`;
                        document.getElementById('transaction-message').innerText = message;

                        // Launch confetti from both sides
                        function launchConfetti() {
                            const duration = 900; // Duration of the animation
                            const end = Date.now() + duration;

                            (function frame() {
                                // Left side
                                confetti({
                                    particleCount: 5,
                                    angle: 60, // Angle for the left side
                                    spread: 55,
                                    origin: { x: 0, y: Math.random() }, // From the left
                                });

                                // Right side
                                confetti({
                                    particleCount: 5,
                                    angle: 120, // Angle for the right side
                                    spread: 55,
                                    origin: { x: 1, y: Math.random() }, // From the right
                                });

                                if (Date.now() < end) {
                                    requestAnimationFrame(frame);
                                }
                            })();
                        }

                        // Start the confetti animation
                        launchConfetti();
                    }
                }, 200); // Check every 200ms for available data (can adjust as needed)

                // Optional: If retrying data retrieval doesn't succeed after some time, show a message or alert
                setTimeout(function() {
                    if (!username || !bank || !account || !currency || !amount) {
                        alert('Data retrieval failed. Redirecting to home page.');
                        window.location.href = 'index.html';  // Redirect to home if data is not available
                    }
                }, 3000000); // Timeout after 3 seconds if data is still missing
            };
        </script>

        <button class="bt" onclick="window.location.href='index.html';">Return To Home</button>
    </div>
</body>
</html>
